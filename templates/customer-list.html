<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Management - Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<script>
    // This takes the list from Python and gives it to JavaScript
    window.backendSearchSeed = {{ search_seed | tojson }};
</script>

<body id="page-customers">
    <aside class="sidebar">
        <h2>CRM Admin</h2>
        <a href="/dashboard" class="nav-link nav-dashboard active">Dashboard</a>
        <a href="/customers" class="nav-link nav-customers">Customer List</a>
        <a href="/templates-manager" class="nav-link nav-templates">Template Manager</a>
        <a href="/history" class="nav-link nav-history">Chat History</a>
        <a href="/repository" class="nav-link nav-repository">Inquiry Repository</a>
        <a href="/scoring" class="nav-link nav-scoring">Lead Scoring</a>
    </aside>

    <main class="main">
        <div class="header">
            <div class="header-left">
                <h1 class="h3 mb-0">Customer Management</h1>
            </div>
            <div class="search-container">
                <input type="text" placeholder="Search leads, rules, or customers..." class="taskbar-search">
            </div>
            <div class="header-right">
                <button class="btn btn-blue" data-bs-toggle="modal" data-bs-target="#addCustomerModal">+ Add
                    Customer</button>
            </div>
        </div>

        <form method="GET" action="/customers" class="mb-4">
            <input type="text" name="q" class="form-control" placeholder="Search by name or email..."
                value="{{ query }}">
        </form>

        <div class="row g-4">
            {% for c in customers %}
            <div class="col-12 col-md-6 col-lg-4">
                <div class="card p-3 shadow-sm border-0 h-100">
                    <div class="d-flex align-items-center mb-3">
                        <div class="avatar-circle me-3">
                            {{ c.name.split(' ')[0][0] }}{{ c.name.split(' ')[-1][0] if c.name.split(' ')|length > 1
                            else '' }}
                        </div>
                        <div>
                            <h5 class="mb-0 fw-bold">{{ c.name }}</h5>
                            <small class="text-muted">{{ c.email }}</small>
                        </div>
                    </div>
                    <div class="mb-3 small">
                        <p class="mb-1 text-secondary"><strong>Phone:</strong> {{ c.phone }}</p>
                        <p class="mb-1 text-secondary"><strong>Staff:</strong> {{ c.assigned_staff or 'Unassigned' }}
                        </p>
                    </div>
                    <div class="mb-3">
                        {% if c.tags %}
                        {% for tag in c.tags.split(',') %}
                        <span class="badge bg-info-subtle text-primary small">{{ tag }}</span>
                        {% endfor %}
                        {% endif %}
                    </div>
                    <div class="mt-auto d-flex gap-2">
                        <a href="/customer/{{ c.id }}" class="btn btn-blue btn-sm w-100">View Profile</a>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="col-12 text-center py-5">
                <p class="text-muted">No customers found. Try adding a new one!</p>
            </div>
            {% endfor %}
        </div>
    </main>

    <div class="modal fade" id="addCustomerModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content p-3">
                <h3 class="h5 mb-3 border-bottom pb-2">Add New Customer</h3>

                <div class="mb-3">
                    <label class="form-label">Name</label>
                    <input type="text" id="newCustName" class="form-control" placeholder="Enter name">
                </div>
                <div class="mb-3">
                    <label class="form-label">Email</label>
                    <input type="email" id="newCustEmail" class="form-control" placeholder="example@mail.com">
                </div>
                <div class="mb-3">
                    <label class="form-label">Phone</label>
                    <input type="text" id="newCustPhone" class="form-control" placeholder="+65...">
                </div>

                <div class="d-flex gap-2">
                    <button class="btn btn-blue w-100" onclick="saveCustomer()">Save</button>
                    <button class="btn btn-gray w-100" data-bs-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>

</html>