<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard ‚Äì Chatbot Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<script>
    // Injects the Python list into a JavaScript variable
    window.backendSearchSeed = {{ search_seed | tojson }};
</script>

<body id="page-dashboard"
    class="{% if current_theme and current_theme != 'light' %}theme-{{ current_theme }}{% endif %}">

    <aside class="sidebar">
        <h2>CRM Admin</h2>
        <a href="/dashboard" class="nav-link nav-dashboard active">Dashboard</a>
        <a href="/customers" class="nav-link nav-customers">Customer List</a>
        <a href="/my-team" class="nav-link nav-my-team d-flex justify-content-between align-items-center">
            My Team
            <div class="d-flex align-items-center gap-1">
                {% if unread_team_messages %}
                <span class="rounded-circle bg-warning" style="width: 10px; height: 10px; display: inline-block;"></span>
                {% endif %}
                {% if team_pending_requests_count and team_pending_requests_count > 0 %}
                <i class="bi bi-exclamation-circle-fill text-danger" style="font-size: 0.9em;"></i>
                {% endif %}
            </div>
        </a>
        <a href="/templates-manager" class="nav-link nav-templates">Template Manager</a>
        <a href="/history" class="nav-link nav-history d-flex justify-content-between align-items-center">
            Chat History
            {% if transfer_request_count and transfer_request_count > 0 %}
            <i class="bi bi-exclamation-circle-fill text-danger" style="font-size: 0.9em;"></i>
            {% endif %}
        </a>
        <a href="/repository" class="nav-link nav-repository">Inquiry Repository</a>
        <a href="/scoring" class="nav-link nav-scoring">Lead Scoring</a>
        {% if session.get('user_role') in ['ultra_admin', 'super_admin', 'admin'] %}
        <a href="/admin/create-account" class="nav-link nav-admin">
            Manage Accounts
            {% if pending_promotion_count and pending_promotion_count > 0 %}
            <span class="badge bg-danger ms-2" style="font-size: 0.7em;">!</span>
            {% endif %}
        </a>
        {% endif %}
        <div class="mt-auto pt-3 border-top border-secondary" style="border-color: rgba(255,255,255,0.1) !important;">
            <div class="dropdown">
                <a href="#" class="d-flex align-items-center text-decoration-none dropdown-toggle" id="dropdownUser1"
                    data-bs-toggle="dropdown" aria-expanded="false">
                    <div class="avatar-circle bg-primary text-white me-2"
                        style="width: 32px; height: 32px; font-size: 14px; display:flex; align-items:center; justify-content:center; border-radius:50%; overflow:hidden;">
                        {% if session.get('user_pic') and 'http' in session.get('user_pic') %}
                        <img src="{{ session.get('user_pic') }}" alt="User"
                            style="width:100%; height:100%; object-fit:cover;">
                        {% elif session.get('user_pic') %}
                        <img src="{{ url_for('static', filename='uploads/' + session.get('user_pic')) }}" alt="User"
                            style="width:100%; height:100%; object-fit:cover;">
                        {% else %}
                        {{ session.get('user_name', 'Admin')[0] | upper }}
                        {% endif %}
                    </div>
                    <strong>{{ session.get('user_name', 'Admin') }}</strong>
                </a>
                <ul class="dropdown-menu dropdown-menu-dark text-small shadow" aria-labelledby="dropdownUser1">
                    <li><a class="dropdown-item" href="/profile">Edit Profile</a></li>
                    <li><a class="dropdown-item" href="/settings">Settings</a></li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li><a class="dropdown-item" href="/logout">Sign out</a></li>
                </ul>
            </div>
        </div>
    </aside>

    <main class="main">
        <div class="header">
            <div class="header-left">
                <h1 style="margin:0; font-size: 24px;">Admin Dashboard</h1>
                <button class="btn btn-gray" data-bs-toggle="modal" data-bs-target="#customizeModal"
                    style="font-size: 12px;" onclick="openCustomizeModal()">‚öôÔ∏è Customize Stats</button>
            </div>
            <div class="search-container">
                <input type="text" placeholder="Search leads, rules, or customers..." class="taskbar-search">
            </div>
            <div class="header-right"></div>
        </div>

        <!-- ===== DYNAMIC SOLID STATS ROW ===== -->
        <div class="row g-3 mb-4" id="statsRow">
            <div class="col-12 text-center py-4" id="statsLoading">
                <span style="color:var(--gray); font-size:0.9rem;">Loading stats‚Ä¶</span>
            </div>
        </div>

        <!-- ===== DYNAMIC GRAPHS SECTION ===== -->
        <div class="row g-4 mb-4" id="graphsRow"></div>

        <!-- ========== ANNOUNCEMENTS CRUD SECTION ========== -->
        <div class="card mb-4 announcement-section" style="padding: 25px;">
            <div class="announcement-header">
                <h3 style="margin:0; font-size: 1.1rem; color: var(--slate-900);">üì¢ Announcements</h3>
                {% if session.get('user_role') in ['ultra_admin', 'super_admin', 'admin'] %}
                <button class="btn btn-blue" id="btnNewAnnouncement" onclick="openAnnouncementModal()">
                    + New Announcement
                </button>
                {% endif %}
            </div>
            <p style="color: var(--gray); font-size: 0.85rem; margin-bottom: 20px;">
                {% if session.get('user_role') in ['ultra_admin', 'super_admin', 'admin'] %}
                Create, view, edit, and delete team announcements from this panel.
                {% else %}
                View the latest announcements here.
                {% endif %}
            </p>
            <div id="announcementsContainer">
                {% if all_announcements %}
                {% for a in all_announcements %}
                <div class="announcement-card" id="announcement-{{ a.id }}" data-id="{{ a.id }}">
                    <div class="announcement-card-left">
                        <span class="announcement-priority-badge priority-{{ a.priority }}">{{ a.priority | upper
                            }}</span>
                        <div class="announcement-card-body">
                            <strong class="announcement-title">{{ a.title }}</strong>
                            <p class="announcement-content">{{ a.content }}</p>
                            <small class="announcement-date">{{ a.created_at or 'N/A' }}</small>
                        </div>
                    </div>
                    {% if session.get('user_role') in ['ultra_admin', 'super_admin', 'admin'] %}
                    <div class="announcement-card-actions">
                        <button class="btn btn-sm btn-gray" title="Edit"
                            onclick="editAnnouncement({{ a.id }}, '{{ a.title | e }}', `{{ a.content | e }}`, '{{ a.priority }}')">‚úèÔ∏è</button>
                        <button class="btn btn-sm btn-red" title="Delete"
                            onclick="confirmDeleteAnnouncement({{ a.id }})">üóëÔ∏è</button>
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
                {% else %}
                <div class="announcement-empty" id="announcementEmpty">
                    <p style="text-align:center; color: var(--gray); padding: 30px 0;">No announcements yet.
                        {% if session.get('user_role') in ['ultra_admin', 'super_admin', 'admin'] %}
                        Click <strong>+ New Announcement</strong> to create one.
                        {% endif %}
                    </p>
                </div>
                {% endif %}
            </div>
        </div>
        <!-- ========== END ANNOUNCEMENTS SECTION ========== -->

        <div class="row g-4">
            <div class="col-12 col-lg-7">
                <div class="card h-100">
                    <h3 style="margin-bottom: 20px; font-size: 1.1rem;">üî• High-Value Leads (Top 3)</h3>
                    <div id="highValueLeadsContainer">
                        {% if high_value_leads %}
                        <div class="list-group list-group-flush">
                            {% for lead in high_value_leads %}
                            <div
                                class="list-group-item px-0 py-3 d-flex align-items-center justify-content-between border-bottom">
                                <div class="d-flex align-items-center">
                                    <div class="avatar-circle me-3 bg-light text-primary"
                                        style="width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold;">
                                        {{ lead.visitor_name[0] | upper }}
                                    </div>
                                    <div>
                                        <h6 class="mb-0 text-dark" style="font-weight:600;">
                                            {{ lead.visitor_name }}
                                            {% if lead.transfer_status == 'pending' and lead.assigned_agent_id|int == session.get('user_id')|int %}
                                            <i class="bi bi-exclamation-circle-fill text-danger ms-1" title="Transfer Request Incoming"></i>
                                            {% endif %}
                                        </h6>
                                        <small class="text-muted" style="font-size:0.85rem;">{{ lead.visitor_email or
                                            'No email' }}</small>
                                    </div>
                                </div>
                                <div class="text-end d-flex align-items-center gap-2">
                                    <span class="badge bg-primary rounded-pill px-3 py-2" style="font-size:0.85rem;">
                                        Score: {{ lead.calculated_score | int }}
                                    </span>
                                    <div style="width: 1px; height: 20px; background: rgba(0,0,0,0.1); margin: 0 4px;">
                                    </div>
                                    <a href="/history?session={{ lead.id }}" class="btn btn-sm btn-outline-primary"
                                        style="font-size: 0.75rem; border-radius: 6px; padding: 4px 10px;">
                                        View
                                    </a>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="text-center py-4">
                            <p class="text-muted mb-0">No leads scored yet.</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="col-12 col-lg-5">
                <div class="card h-100">
                    <h3 style="margin-bottom: 20px; font-size: 1.1rem;">üí¨ Latest Customer Chats</h3>
                    <div id="latestChatsContainer">
                        {% if latest_chats %}
                        <div class="list-group list-group-flush">
                            {% for chat in latest_chats %}
                            <a href="/history?session={{ chat.id }}"
                                class="list-group-item list-group-item-action px-0 py-3 border-bottom">
                                <div class="d-flex w-100 justify-content-between mb-1">
                                    <h6 class="mb-0 fw-bold text-dark">
                                        {{ chat.visitor_name }}
                                        {% if chat.transfer_status == 'pending' and chat.assigned_agent_id|int == session.get('user_id')|int %}
                                        <i class="bi bi-exclamation-circle-fill text-danger ms-1" title="Transfer Request Incoming"></i>
                                        {% endif %}
                                    </h6>
                                    <small class="text-muted">{{ chat.updated_at.split(' ')[1] if chat.updated_at and '
                                        ' in chat.updated_at else chat.updated_at }}</small>
                                </div>
                                <p class="mb-0 small text-muted text-truncate" style="max-width: 90%;">
                                    {% if chat.chat_messages %}
                                    {{ chat.chat_messages[-1].text }}
                                    {% else %}
                                    <em>No messages yet</em>
                                    {% endif %}
                                </p>
                            </a>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="text-center py-4">
                            <p class="text-muted mb-0">No recent chats found.</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- ========== ALL LEADS SECTION ========== -->
        <div class="row g-4 mt-2 mb-4">
            <div class="col-12">
                <div class="card" style="padding: 25px;">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3 style="margin:0; font-size: 1.1rem; color: var(--slate-900);">üìä All Customer Leads</h3>
                        <div class="d-flex align-items-center gap-2">
                            <label for="allLeadsSort" class="text-muted small" style="white-space:nowrap;">Sort
                                by:</label>
                            <select class="form-select form-select-sm" id="allLeadsSort"
                                style="width: 180px; border-radius: 8px;" onchange="sortAllLeads()">
                                <option value="score-desc">üöÄ Highest Score First</option>
                                <option value="score-asc">üìâ Lowest Score First</option>
                                <option value="name-asc">üî§ Name A-Z</option>
                                <option value="name-desc">üî§ Name Z-A</option>
                            </select>
                        </div>
                    </div>

                    <div id="allLeadsContainer">
                        {% if all_leads %}
                        <div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-3" id="allLeadsList">
                            {% for lead in all_leads %}
                            <div class="col lead-item" data-score="{{ lead.calculated_score | int }}"
                                data-name="{{ lead.visitor_name }}">
                                <div class="card h-100 shadow-sm border p-3 hover-shadow"
                                    style="transition: all 0.2s; border-radius: 12px; background: #fff;">
                                    <div class="d-flex align-items-center justify-content-between mb-3">
                                        <div class="d-flex align-items-center">
                                            <div class="avatar-circle me-3 bg-light text-primary"
                                                style="width:36px; height:36px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold; font-size: 0.9rem;">
                                                {{ lead.visitor_name[0] | upper }}
                                            </div>
                                            <div>
                                                <h6 class="mb-0 text-dark" style="font-weight:600; font-size: 0.95rem;">
                                                    {{ lead.visitor_name }}</h6>
                                                <small class="text-muted" style="font-size:0.75rem;">{{
                                                    lead.visitor_email or 'No email' }}</small>
                                            </div>
                                        </div>
                                        <div class="text-end">
                                            <span class="badge bg-primary-subtle text-primary rounded-pill px-2 py-1"
                                                style="font-size:0.7rem;">
                                                Scored: {{ lead.calculated_score | int }}
                                            </span>
                                        </div>
                                    </div>
                                    <div
                                        class="d-flex justify-content-between align-items-center mt-auto pt-2 border-top">
                                        <small class="text-muted" style="font-size: 0.7rem;">ID: #{{ lead.id }}</small>
                                        <a href="/history?session={{ lead.id }}" class="btn btn-sm btn-outline-primary"
                                            style="font-size: 0.7rem; border-radius: 6px; padding: 2px 12px;">
                                            Open Chat
                                        </a>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <div class="text-center py-5">
                            <p class="text-muted mb-0">No lead data available to show.</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        <!-- ========== END ALL LEADS SECTION ========== -->

        <!-- ===== CUSTOMIZE DASHBOARD MODAL ===== -->
        <div class="modal fade" id="customizeModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content">
                    <div class="modal-header border-0 pb-0">
                        <h5 class="modal-title fw-bold">‚öôÔ∏è Customize Dashboard</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p style="color: var(--gray); font-size: 0.85rem; margin-bottom: 16px;">Choose which stats and
                            graphs to display on your dashboard. Your preferences are saved to your account.</p>

                        <!-- Tab Navigation -->
                        <ul class="nav nav-tabs customize-tabs mb-3" id="customizeTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="stats-tab" data-bs-toggle="tab"
                                    data-bs-target="#statsPane" type="button" role="tab">üìä Solid Stats</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="graphs-tab" data-bs-toggle="tab"
                                    data-bs-target="#graphsPane" type="button" role="tab">üìà Graphs</button>
                            </li>
                        </ul>

                        <!-- Tab Content -->
                        <div class="tab-content" id="customizeTabContent">
                            <!-- Solid Stats Pane -->
                            <div class="tab-pane fade show active" id="statsPane" role="tabpanel">
                                <div class="customize-grid" id="customizeStatsList">
                                    <!-- dynamically populated -->
                                </div>
                            </div>
                            <!-- Graphs Pane -->
                            <div class="tab-pane fade" id="graphsPane" role="tabpanel">
                                <div class="customize-grid" id="customizeGraphsList">
                                    <!-- dynamically populated -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer border-0 pt-0">
                        <button type="button" class="btn btn-blue w-100" onclick="saveDashboardConfig()">Save
                            Changes</button>
                        <button type="button" class="btn btn-gray w-100" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Announcement Create / Edit Modal -->
        <div class="modal fade" id="announcementModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header border-0 pb-0">
                        <h5 class="modal-title fw-bold" id="announcementModalTitle">New Announcement</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" id="annEditId" value="">
                        <div class="form-group">
                            <label for="annTitle">Title</label>
                            <input type="text" id="annTitle" placeholder="e.g. System Maintenance Notice"
                                class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="annContent">Content</label>
                            <textarea id="annContent" rows="4" placeholder="Write your announcement here..."
                                class="form-control"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="annPriority">Priority</label>
                            <select id="annPriority" class="form-select">
                                <option value="low">Low</option>
                                <option value="normal" selected>Normal</option>
                                <option value="high">High</option>
                                <option value="urgent">Urgent</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer border-0 pt-0">
                        <button type="button" class="btn btn-blue w-100" id="btnSaveAnnouncement"
                            onclick="saveAnnouncement()">Create Announcement</button>
                        <button type="button" class="btn btn-gray w-100" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-sm">
                <div class="modal-content">
                    <div class="modal-header border-0 pb-0">
                        <h5 class="modal-title fw-bold" style="color: var(--red);">‚ö†Ô∏è Confirm Delete</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p style="font-size: 0.9rem; color: var(--gray);">Are you sure you want to delete this
                            announcement?
                            This action cannot be undone.</p>
                        <input type="hidden" id="deleteTargetId" value="">
                    </div>
                    <div class="modal-footer border-0 pt-0">
                        <button type="button" class="btn btn-red w-100" onclick="deleteAnnouncement()">Yes,
                            Delete</button>
                        <button type="button" class="btn btn-gray w-100" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </div>
            </div>
        </div>


        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script src="{{ url_for('static', filename='app.js') }}"></script>

        <script>
            /* ==========================================================================
               ANNOUNCEMENTS CRUD ‚Äì Dashboard Inline Script
               ========================================================================== */

            // --- CREATE / UPDATE ---
            function openAnnouncementModal(editId, title, content, priority) {
                document.getElementById('annEditId').value = editId || '';
                document.getElementById('annTitle').value = title || '';
                document.getElementById('annContent').value = content || '';
                document.getElementById('annPriority').value = priority || 'normal';

                const modalTitle = document.getElementById('announcementModalTitle');
                const saveBtn = document.getElementById('btnSaveAnnouncement');

                if (editId) {
                    modalTitle.textContent = 'Edit Announcement';
                    saveBtn.textContent = 'Save Changes';
                } else {
                    modalTitle.textContent = 'New Announcement';
                    saveBtn.textContent = 'Create Announcement';
                }

                const modal = new bootstrap.Modal(document.getElementById('announcementModal'));
                modal.show();
            }

            // Alias for inline onclick in cards
            function editAnnouncement(id, title, content, priority) {
                openAnnouncementModal(id, title, content, priority);
            }

            async function saveAnnouncement() {
                const id = document.getElementById('annEditId').value;
                const title = document.getElementById('annTitle').value.trim();
                const content = document.getElementById('annContent').value.trim();
                const priority = document.getElementById('annPriority').value;

                if (!title || !content) {
                    alert('Title and Content are required!');
                    return;
                }

                const payload = { title, content, priority };

                try {
                    let res;
                    if (id) {
                        // UPDATE (PUT)
                        res = await fetch(`/api/announcements/${id}`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                    } else {
                        // CREATE (POST)
                        res = await fetch('/api/announcements', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                    }

                    if (res.ok) {
                        // Close modal and refresh page to show new/updated data
                        bootstrap.Modal.getInstance(document.getElementById('announcementModal')).hide();
                        window.location.reload();
                    } else {
                        const err = await res.json();
                        alert('Error: ' + (err.error || 'Could not save announcement'));
                    }
                } catch (e) {
                    console.error('Save announcement error:', e);
                    alert('Network error. Please try again.');
                }
            }

            // --- DELETE ---
            function confirmDeleteAnnouncement(id) {
                document.getElementById('deleteTargetId').value = id;
                const modal = new bootstrap.Modal(document.getElementById('deleteConfirmModal'));
                modal.show();
            }

            async function deleteAnnouncement() {
                const id = document.getElementById('deleteTargetId').value;
                if (!id) return;

                try {
                    const res = await fetch(`/api/announcements/${id}`, { method: 'DELETE' });
                    if (res.ok) {
                        bootstrap.Modal.getInstance(document.getElementById('deleteConfirmModal')).hide();
                        // Remove card from DOM with animation
                        const card = document.getElementById(`announcement-${id}`);
                        if (card) {
                            card.style.transition = 'opacity 0.3s, transform 0.3s';
                            card.style.opacity = '0';
                            card.style.transform = 'translateX(30px)';
                            setTimeout(() => {
                                card.remove();
                                // Show empty state if no more announcements
                                const container = document.getElementById('announcementsContainer');
                                if (container && container.querySelectorAll('.announcement-card').length === 0) {
                                    container.innerHTML = '<div class="announcement-empty" id="announcementEmpty"><p style="text-align:center; color: var(--gray); padding: 30px 0;">No announcements yet. Click <strong>+ New Announcement</strong> to create one.</p></div>';
                                }
                            }, 300);
                        }
                    } else {
                        alert('Error deleting announcement.');
                    }
                } catch (e) {
                    console.error('Delete announcement error:', e);
                    alert('Network error. Please try again.');
                }
            }

            // --- ALL LEADS SORTING ---
            function sortAllLeads() {
                const sort = document.getElementById('allLeadsSort').value;
                const container = document.getElementById('allLeadsList');
                if (!container) return;

                const items = Array.from(container.querySelectorAll('.lead-item'));

                items.sort((a, b) => {
                    const scoreA = parseInt(a.dataset.score || 0);
                    const scoreB = parseInt(b.dataset.score || 0);
                    const nameA = a.dataset.name.toLowerCase();
                    const nameB = b.dataset.name.toLowerCase();

                    if (sort === 'score-desc') return scoreB - scoreA;
                    if (sort === 'score-asc') return scoreA - scoreB;
                    if (sort === 'name-asc') return nameA.localeCompare(nameB);
                    if (sort === 'name-desc') return nameB.localeCompare(nameA);
                    return 0;
                });

                // Re-append sorted items
                items.forEach(item => container.appendChild(item));
            }
        </script>
</body>

</html>