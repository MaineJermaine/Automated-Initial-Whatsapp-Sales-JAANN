<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Edit Profile - CRM</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body id="page-customers"

    class="{% if current_theme and current_theme != 'light' %}theme-{{ current_theme }}{% endif %}">

    <aside class="sidebar">
        <h2>CRM Admin</h2>
        <a href="/dashboard" class="nav-link nav-dashboard">Dashboard</a>
        <a href="/customers" class="nav-link nav-customers active">Customer List</a>
        <a href="/templates-manager" class="nav-link nav-templates">Template Manager</a>
        <a href="/history" class="nav-link nav-history">Chat History</a>
        <a href="/repository" class="nav-link nav-repository">Inquiry Repository</a>
        <a href="/scoring" class="nav-link nav-scoring">Lead Scoring</a>
        {% if session.get('user_role') in ['super_admin', 'admin'] %}
        <a href="/admin/create-account" class="nav-link nav-admin">
            Manage Accounts
            {% if pending_promotion_count and pending_promotion_count > 0 %}
            <span class="badge bg-danger ms-2" style="font-size: 0.7em;">!</span>
            {% endif %}
        </a>
        {% endif %}

        <!-- Sidebar Footer -->
        <div class="mt-auto pt-3 border-top border-secondary" style="border-color: rgba(255,255,255,0.1) !important;">
            <div class="dropdown">
                <a href="#" class="d-flex align-items-center text-decoration-none dropdown-toggle" id="dropdownUser1"
                    data-bs-toggle="dropdown" aria-expanded="false">
                    <div class="avatar-circle bg-primary text-white me-2"
                        style="width: 32px; height: 32px; font-size: 14px; display:flex; align-items:center; justify-content:center; border-radius:50%; overflow:hidden;">
                        {% if session.get('user_pic') and 'http' in session.get('user_pic') %}
                        <img src="{{ session.get('user_pic') }}" alt="User"
                            style="width:100%; height:100%; object-fit:cover;">
                        {% elif session.get('user_pic') %}
                        <img src="{{ url_for('static', filename='uploads/' + session.get('user_pic')) }}" alt="User"
                            style="width:100%; height:100%; object-fit:cover;">
                        {% else %}
                        {{ session.get('user_name', 'Admin')[0] | upper }}
                        {% endif %}
                    </div>
                    <strong>{{ session.get('user_name', 'Admin') }}</strong>
                </a>
                <ul class="dropdown-menu dropdown-menu-dark text-small shadow" aria-labelledby="dropdownUser1">
                    <li><a class="dropdown-item" href="/profile">Edit Profile</a></li>
                    <li><a class="dropdown-item" href="/settings">Settings</a></li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li><a class="dropdown-item" href="/logout">Sign out</a></li>
                </ul>
            </div>
        </div>
    </aside>

    <main class="main">
        <div class="header">
            <h1 class="h3">Edit Profile</h1>
        </div>

        <div class="row">
            <div class="col-md-8 mx-auto">
                <div class="card">
                    <div class="card-header bg-white border-bottom">
                        <h5 class="mb-0">Profile Details</h5>
                    </div>
                    <div class="card-body p-4">
                        {% if error %}
                        <div class="alert alert-danger">{{ error }}</div>
                        {% endif %}
                        <form method="POST" enctype="multipart/form-data">

                            <div class="text-center mb-4">
                                <div class="avatar-circle bg-primary text-white mx-auto mb-3 shadow"
                                    style="width: 100px; height: 100px; font-size: 40px; display:flex; align-items:center; justify-content:center; border-radius:50%; overflow:hidden;">
                                    {% if user.profile_picture and 'http' in user.profile_picture %}
                                    <img src="{{ user.profile_picture }}" alt="Profile"
                                        style="width:100%; height:100%; object-fit:cover;">
                                    {% elif user.profile_picture %}
                                    <img src="{{ url_for('static', filename='uploads/' + user.profile_picture) }}"
                                        alt="Profile" style="width:100%; height:100%; object-fit:cover;">
                                    {% else %}
                                    {{ user.username[0] | upper }}
                                    {% endif %}
                                </div>
                                <div>
                                    <label for="profile_picture" class="btn btn-sm btn-primary">
                                        Upload New Picture <input type="file" id="profile_picture"
                                            name="profile_picture" hidden
                                            onchange="document.getElementById('file-name').textContent = this.files[0].name">
                                    </label>
                                    <span id="file-name" class="ms-2 text-muted small"></span>
                                </div>
                            </div>

                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label for="username" class="form-label">Username</label>
                                    <input type="text" class="form-control" id="username" value="{{ user.username }}"
                                        disabled>
                                    <small class="text-muted">Username cannot be changed</small>
                                </div>
                                <div class="col-md-6">
                                    <label for="name" class="form-label">Display Name</label>
                                    <input type="text" class="form-control" id="name" name="name"
                                        value="{{ user.name }}">
                                </div>
                                <div class="col-12">
                                    <label for="bio" class="form-label">Bio</label>
                                    <textarea class="form-control" id="bio" name="bio"
                                        rows="3">{{ user.bio }}</textarea>
                                </div>
                            </div>

                            <hr class="my-4">

                            <h5 class="mb-3">Change Password</h5>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label for="new_password" class="form-label">New Password</label>
                                    <input type="password" class="form-control" id="new_password" name="new_password">
                                </div>
                                <div class="col-md-6">
                                    <label for="confirm_password" class="form-label">Confirm New Password</label>
                                    <input type="password" class="form-control" id="confirm_password"
                                        name="confirm_password">
                                </div>
                            </div>

                            <div class="mt-4 text-end">
                                <a href="/dashboard" class="btn btn-gray me-2">Cancel</a>
                                <button type="submit" class="btn btn-primary">Save Changes</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>

</html>